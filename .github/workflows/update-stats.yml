name: Update README stats

on:
  schedule:
    - cron: '*/2 * * * *'
    # - cron: '0 0 * * 0'

  push:
    branches:
      - master

jobs:
  update-stats:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Create misc folder if not exists
        run: |
          mkdir -p ./misc

      - name: Update Stats
        run: |
          wget -O ./misc/stats.svg https://github-readme-stats.vercel.app/api/top-langs/?username=mariav7&layout=compact&theme=radical&hide_border=true
          ls -l ./misc

      - name: Install ImageMagick
        run: sudo apt-get install imagemagick

      - name: Convert SVG to PNG
        run: |
          convert -background none -font sans-serif ./misc/stats.svg ./misc/stats.png
          rm ./misc/stats.svg
          git status
          git config --global user.email "mflores-@student.42.fr"
          git config --global user.name "mflores-"
          git add .
          git commit -m "UPDATE: README.md stats"
          git push
